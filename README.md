# VTBID Specification

## 0. Status

*  2020-07-12 v0.1.0 Proposal

## 1. 介绍

VTBID是一个规范，用于对目前错综复杂的虚拟主播数据提供全局唯一标识，方便各个系统进行数据对接。

虚拟主播是指使用Live2D或者3D等图形技术生成的虚拟形象在网络平台上进行视频创作和直播等娱乐活动的UP主，一般在Youtube上称为Vtuber（简称VTB），在哔哩哔哩上称为Vup。VTB有时也作为虚拟主播的通称。

随着虚拟主播人气的日益增长，大量相关统计分析和辅助工具如雨后春笋般涌现。但早期往往以针对某一平台，数据自动爬取分析为主，面对多平台活动的虚拟主播，数据难以整合和关联；同时，不同工具之间的数据也难以导入和共享。而VTBID规范的作用如同身份证号码和（中国）统一社会信用代码在生活中的作用，使得凭借一个ID即可找到这个自然人或者组织企业，并将各个地方的信息进行关联整合。

## 2. 特点

VTBID有以下几个特点和原则：
   1. 唯一性

      1. 任何一个虚拟主播（或确定的组合）都有且只有一个VTBID。可以任意增减和替换成员的组合视作普通社团，不分配VTBID。
      2. VTBID不等于关系型数据库主键，可以使用VTBID作为主键，也可以自由设置其它的唯一标识方式；但VTBID可以唯一标识数据和实际VTB之间的关系，跨系统数据交互时，可以作为标识使用。

   2. 独立性和可回溯性
   
      1. 组合的成员如果可以独立于其它成员活动（无论是否以组合名义），则拥有各自的子ID；否则，只分配组合ID。
      2. 若该VTB进行了“转生”，并且本人将两个身份进行关联，VTBID不变；否则分配新VTBID，视作新的VTB。
      3. 若组合发生人员变动，重组或拆分合并，根据变动主体根据上述规则重新确认并分配。
 
   3. 绑皮不绑人
   
      1. VTBID绑定到对应的虚拟形象（或虚拟形象组合），不绑定中之人。若一个中之人有多个互不关联的虚拟形象，分配各自的VTBID。若中之人发生变化，VTBID不变。若虚拟形象发生重大变化，无法和之前形象判定为同一形象的，按照2.2所述处理。 e.g.紫米粽子也是粽子
      2. 临时借用他人虚拟形象或者账号进行活动，产生相关数据的，如果可以确定中之人身份，按照中之人平时所用形象的VTBID进行关联；否则，关联活动所用的形象并作出说明。

## 3. 结构

VTBID是一个18位的HEX字符串，其中包含了0-9的数字以及A、B、C、D、E、F这6个大写字母。

VTBID由几下几个部分构成：国家地区代码，平台标识码，类型码，出生日期，系统编码及序列号，校验码

    帕里(Paryi)的VTBID（假定已经统一确认）
    
    0081    02     1    0316    01002F   A
    日本  哔哩哔哩  个人  3月16日   序列号  校验码 

* 国家地区代码
  4位，为国际电话区号，不足补前导0。这个代码填在分配VTBID时中之人所属的国家地区；如果未知，填虚拟形象实际主要活动所在的国家地区；如果仍未知，填所通常使用的语言文字所属的国家地区。例如中国大陆的代码是0086。
* 平台标识码
  2位，16进制数字，不足补前导0。用于标识在分配VTBID时虚拟形象主要活动平台（仅限可进行直播或视频发布的平台，不包括Twitter等纯社交平台），有多个平台且活动频率接近时，填最早公开信息的平台编码。值如下表所示，并可申请添加。

  |值|含义|
  |--|--|
  |00|保留值|
  |01|Youtube|
  |02|bilibili|
  |03|niconico|
  |04|twitch|
  |05|Tik Tok|
  |...|...|
  |FF|未纳入的平台|
  
* 类型码
  1位，16进制数字。用于标识VTBID类型，如下表所示。其中0表示未经统一确认，属于单个系统内临时分配的ID。

  |值|含义|
  |--|---
  |0|临时ID|
  |1 |个人|
  |2|组合|

* 出生日期
  4位，MMdd格式数字。用于标识该虚拟形象的生日，如果生日未公开的，填写出道日期。如果出道日期不可考证的，填写最早可查证的视频发布日期或者直播日期。
* 系统编码及序列号
  6位，16进制数字。由各自分配VTBID的系统进行编码，要求单一系统内按照分配时间顺序递增。若多个系统对同一形象分配了不同的VTBID，数据同步时按照序列号的绝对大小选取较小者。理论最大可分配 16,777,215 个VTB。
* 校验码 1位，16进制数字，算法如下：
  1. 将VTBID除去校验码剩下的部分分别按照该部分使用的进制（10或16进制）转换为二进制，补足至位数为4的倍数，并进行拼接。
  例：

      |   |0081|02|1|0316|01002F|
      |:-:|:-:|:-:|:-:|:-:|:-:|
      |HEX|0x51|0x2|0x1|0x13C|0x1002F|
      |BIN|0000 0000 0101 0001|0000 0010|0001|0000 0011 0001 0110|0000 0000 0000 0001 0011 1100|

  2. 将结果每8位重组为一个字节，不足的最后补0。对每个字节分别和常量C0中的对应字节做异或运算，并将结果再和常量C1中的对应字节做异或运算，得到一个新的字节数组。
  
      ```c
      C0 = {0xE5, 0x6D, 0xF4, 0x7A, 0xCF, 0x41, 0x0D, 0x44, 0xFD}
      C1 = {0xFF, 0x09, 0x40, 0x79, 0xCD, 0x1A, 0x42, 0xAA, 0xA5}
      ```

  3. 对结果求和，再对16取模，得到最终校验码。
  例：

      |   | 00| 51| 02| 10| 31| 60| 00| 13| C0|
      |:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
      |XOR| E5| 6D| F4| 7A| CF| 41| 0D| 44| FD|
      |   | E5| 3C| F6| 6A| FE| 21| 0D| 57| 3D|
      |XOR| FF| 09| 40| 79| CD| 1A| 42| AA| A5|
      |   | 1A| 35| B6| 13| 33| 3B| 4F| FD| 98|
      |SUM|   |   |   |   | ↓ |   |   |   |   |
      |   |   |   |   |   |874|   |   |   |   | 
      |MOD|   |   |   |   | 16|   |   |   |   | 
      |   |   |   |   |   | A |   |   |   |   | 

